# 第43条：算法调用优先于手写循环

## 一、核心观点

> **不要重复造轮子**。STL已经为绝大多数常见循环操作提供了现成的算法——如查找、替换、计数、变换、删除等。
> 因此，**应尽量使用标准算法（如 `find`, `count`, `accumulate`, `remove_if` 等）代替手写的for循环**。

---

## 二、为什么要优先使用算法

### 1️⃣ 可读性更强

算法名即语义。例如：

```cpp
if (find(v.begin(), v.end(), target) != v.end())
```

比手写的 for 循环：

```cpp
bool found = false;
for (auto it = v.begin(); it != v.end(); ++it)
    if (*it == target) { found = true; break; }
```

更清晰地表达“在容器中查找元素”的意图。
代码读者一眼就能看懂算法含义，而不必在循环中推理逻辑。

---

### 2️⃣ 更少的错误风险

标准算法经过严格测试与优化，能避免循环中常见的“边界错误”“迭代器越界”“忘记递增”等低级bug。
手写循环极易出现 off-by-one、重复访问、逻辑分支遗漏等问题。

---

### 3️⃣ 性能更优

STL算法由标准库实现者在底层做过**针对容器类型和平台的优化**（如内联、迭代器特化、底层汇编优化）。
使用算法往往比自己写循环更快，尤其是在编译器能识别`std::transform`、`std::accumulate`等并行化模式时。

---

### 4️⃣ 与泛型算法生态兼容

STL算法与**迭代器、函数对象（functor/lambda）**自然协作。
这样，你可以组合出更通用的代码，不依赖容器类型，增强复用性。例如：

```cpp
transform(v.begin(), v.end(), v.begin(), [](int x){ return x * 2; });
```

比手写 `for` 循环修改元素更通用：
它既适用于 `vector`，也能用于 `list`、`deque` 等。

---

## 三、常见可替代模式对比

| 任务        | 手写循环                       | 推荐算法写法                                     |
| --------- | -------------------------- | ------------------------------------------ |
| 查找元素      | `for(auto x: v) if(x==k)`  | `find(v.begin(), v.end(), k)`              |
| 计数满足条件的元素 | `for(...) if(...) count++` | `count_if(begin(v), end(v), pred)`         |
| 修改所有元素    | `for(...) v[i]=f(v[i]);`   | `transform(begin(v), end(v), begin(v), f)` |
| 删除满足条件的元素 | `for(...) erase(...)`      | `remove_if` + `erase`                      |
| 求和或统计     | `for(...) sum+=v[i];`      | `accumulate(begin(v), end(v), 0)`          |
| 是否全部满足    | 手动遍历                       | `all_of`、`any_of`、`none_of`                |

---

## 四、例子比较

### ❌ 手写循环（冗长、脆弱）

```cpp
int sum = 0;
for (auto it = v.begin(); it != v.end(); ++it)
    sum += *it;
```

### ✅ 使用算法（简洁、可扩展）

```cpp
int sum = accumulate(v.begin(), v.end(), 0);
```

> 这样若改用 `list`、`set` 等容器，无需修改循环逻辑。

---

## 五、例外情况

有少数场合手写循环是合理的：

1. **循环体非常复杂**，包含多层条件或早退逻辑。
2. **算法组合不自然**（例如同时修改两个不同容器）。
3. **需要维护外部状态**（例如带索引、跨容器同步修改）。

即便如此，也建议优先考虑组合多个算法而非从头写for循环。

---

## 六、总结

* ✅ **首选STL算法**：能用`find`、`count`、`transform`、`accumulate`就别写循环。
* ✅ **好处**：语义清晰 + 少bug + 性能高 + 易维护。
* 🚫 **例外**：仅当算法组合极其不自然或语义混乱时，才考虑自己写循环。

> 简而言之：
> **“如果你能用算法表达你的意图，就不要再用for循环来解释它。”**

# 第24条：`map::operator[]` vs `map::insert`

**核心思想**：当程序对效率非常敏感时，在 `std::map` 中操作键值对，要谨慎选择使用 `operator[]` 还是 `insert`，因为它们的性能表现和行为略有差异。

---

## 1️⃣ `map::operator[]`

* **语法**：`map[key] = value;`
* **特点**：

  1. 如果 `key` **存在**，直接返回对应的值的引用，可进行修改。
  2. 如果 `key` **不存在**，会 **自动插入一个默认值** 的元素，然后返回该值的引用。
* **性能影响**：

  * 插入不存在的 key 时，额外生成默认值对象。
  * 每次访问都可能涉及查找或插入，可能比 `insert` 慢一点。

```cpp
std::map<int, int> mp;
mp[5] = 10;   // 如果 key=5 不存在，会先创建 mp[5]=0，然后再赋值为10
```

---

## 2️⃣ `map::insert`

* **语法**：`mp.insert({key, value});`
* **特点**：

  1. **只插入**，不会修改已有元素。
  2. 返回一个 `pair<iterator, bool>`：

     * `bool` 表示插入是否成功（key 是否存在）
     * `iterator` 指向插入的元素或已存在的元素
* **性能优势**：

  * 不会创建不必要的默认值对象
  * 对于只需要 **插入且不修改已存在元素** 的情况，比 `operator[]` 更高效

```cpp
std::map<int, int> mp;
auto res = mp.insert({5, 10});
if(!res.second) {
    // key=5 已存在，不会插入
}
```

---

## 3️⃣ 使用建议

| 场景             | 推荐方式         | 原因              |
| -------------- | ------------ | --------------- |
| 访问并可能修改元素      | `operator[]` | 方便直接操作元素        |
| 仅仅插入元素，不想覆盖    | `insert`     | 避免默认值构造，提高效率    |
| 高性能场景（频繁操作大数据） | `insert`     | 减少不必要的对象构造与查找开销 |

---

**总结**：

> 在 `std::map` 中，`operator[]` 会在不存在时自动创建元素，而 `insert` 只做插入不改已有元素。在性能敏感的情况下，**慎用 `operator[]`，优先考虑 `insert`**，尤其是当大量插入操作可能造成默认值对象生成时。

# JZ85 连续子数组的最大和（Ⅱ）（笔记＋题解思路）

## 题目概述

* **输入**：整型数组 `array`（`1 ≤ n ≤ 1e5`，`-100 ≤ a[i] ≤ 100`）
* **目标**：在所有**连续**子数组中，找到**元素和最大的子数组本身**
* **特殊规则**：若最大和的子数组不止一个，**返回其中长度最长**的（题目保证“最长者唯一”）
* **复杂度**：期望时间 **O(n)**，空间 **O(1)**（返回结果不计入空间）

> 与 JZ42 的区别：JZ42 只要“最大**和**”；JZ85 需要“最大**和**对应的**那一段**”，且“同和取**最长**”。

---

## 一、问题本质与建模

核心仍是 **Kadane 算法**（最大子段和）：逐一扫描元素，决定“**续前**”还是“**另起**”。
JZ85 在此基础上**记录区间端点**，并在“**和相等时**”按“**更长优先**”更新全局答案。

---

## 二、状态与转移（闭区间表述）

为便于叙述，本文内部用**闭区间** `[L, R]` 维护当前段与答案段。

* `curSum`：以 `R=i` 结尾的最佳子数组和
* `curL, curR=i`：该子数组的左右端点
* `bestSum`：截至当前的全局最优和
* `bestL, bestR`：当前答案段（满足“和最大，且同和取最长”）

**到达第 `i` 个元素 `a[i]` 时的局部决策：**

* 若 `curSum + a[i] < a[i]`：**另起**
  `curSum = a[i]`，`curL = curR = i`
* 否则：**续前**
  `curSum += a[i]`，`curR = i`

**全局答案维护（关键）**：

* 若 `curSum > bestSum`：更新答案段为 `[curL, curR]`
* 若 `curSum == bestSum`：**比较长度**，更长者胜
  等价比较：`(curR - curL) > (bestR - bestL)`（两边同时 +1 可省略）

> 这一步正是题目“同和取最长”的落地规则。

---

## 三、等价的右开区间写法（更不易错）

若改用**左闭右开** `[L, R)` 记录区间，令 `R` 永远指向“尾后一位”，则：

* 当前段长度 = `R - L`，不涉及 `+1`
* 切片直接用 `(begin + L, begin + R)`，无需额外 `+1`
* 续前时 `R = i + 1`，另起时 `L = i, R = i + 1`

这在实现中能**统一长度与切片**的写法，避免 off-by-one。

---

## 四、为什么“同和取最长”要在相等时比较长度？

Kadane 决定的是**以 i 结尾**的“最佳”。当出现多个“全局最大和”段时：

* 如果直接用 `curSum >= bestSum` 覆盖，就可能把**更短**的后继段覆盖掉**更长**的先前段；
* 因此在 `curSum == bestSum` 时，必须**显式比较长度**，选择更长的那一段。

> 题目保证“最长者唯一”，因此不会出现“和相等且长度也相等”还需进一步规则的情况。

---

## 五、复杂度与边界

* **时间**：线性单扫，`O(n)`
* **空间**：常数个变量，`O(1)`（返回切片不计）
* **边界**：

  * 全负数：算法会自动选择最大元素（另起为单点）
  * `0` 的存在：不会影响正确性；在“同和时取更长”的规则下，`0` 还能帮助延长区间
  * `n=1`：答案即为该元素

---

## 六、样例速推

### 样例一

`[1, -2, 3, 10, -4, 7, 2, -5]`
在 `3,10,-4,7,2` 这段中，`curSum` 达到全局最大 `18`；与之前任何同和结果比较，其长度更长 → 返回 `[3,10,-4,7,2]`。

### 样例三（体现“同和取最长”）

`[1,2,-3,4,-1,1,-3,2]`
最大和为 `4`，候选有 `[4]`、`[4,-1,1]`、`[1,2,-3,4]`、`[1,2,-3,4,-1,1]`。
显式按长度打破平局后，选择**最长**的 `[1,2,-3,4,-1,1]`。

---

## 七、常见失误

1. **平局覆盖错误**：只在 `curSum > bestSum` 时更新；或在 `curSum == bestSum` 时不比较长度、直接覆盖。
2. **端点维护混乱**：另起时忘记把 `L, R` 重置到当前；续前时 `R` 未跟到 `i`。
3. **长度计算 off-by-one**：闭区间用 `R-L+1`；若使用右开区间，长度与切片天然统一（推荐）。

---

## 八、一页纸总结

* **目标**：找出“**和最大**且**最长**”的连续子数组本身
* **核心**：Kadane + 端点记录 + **平局按长度**更新
* **规则**：

  * 续前/另起：`curSum + a[i]` 与 `a[i]` 比较
  * 刷新答案：

    * `curSum > bestSum` → 更新
    * `curSum == bestSum` → 取更长
* **复杂度**：时间 `O(n)`，空间 `O(1)`
* **实现建议**：优先使用**右开区间** `[L, R)` 管理长度与切片，减少 ±1 心算

> 一句话记：**Kadane 定和、端点定段；同和比长，唯一即定。**

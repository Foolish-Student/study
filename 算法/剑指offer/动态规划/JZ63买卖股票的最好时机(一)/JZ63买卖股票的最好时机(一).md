
# JZ63 题解｜买卖股票的最好时机（一）

## 题目概述
假设你有一个数组prices，长度为n，其中prices[i]是股票在第i天的价格，请根据这个价格数组，返回买卖股票能获得的最大收益

1.你可以买入一次股票和卖出一次股票，并非每天都可以买入或卖出一次，总共只能买入和卖出一次，且买入必须在卖出的前面的某一天

2.如果不能获取到任何利润，请返回0

3.假设买入卖出均无手续费

* **输入**：数组 `prices`（`0 ≤ n ≤ 10^5`，`0 ≤ prices[i] ≤ 10^4`）
* **规则**：

  * 只能买入一次、卖出一次（买在前，卖在后）
  * 如果无利润，返回 `0`
  * 无手续费
* **目标**：最大化利润
* **复杂度要求**：时间 **O(n)**，空间 **O(1)**

---

## 一、问题本质与建模

这个问题可以抽象成 **“股票买卖的状态机 DP”**：

每一天都有两种状态：

1. **不持股**：`dp[i][0]` → 第 i 天不持股时的最大利润
2. **持股**：`dp[i][1]` → 第 i 天持股时的最大利润

转移关系：

* **不持股**：

  * 前一天也不持股：`dp[i-1][0]`
  * 或者昨天持股，今天卖出：`dp[i-1][1] + prices[i]`
  * 综合：

    ```
    dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])
    ```

* **持股**：

  * 前一天已经持股：`dp[i-1][1]`
  * 或者今天买入（只能买一次，相当于 -prices\[i]）：

    ```
    dp[i][1] = max(dp[i-1][1], -prices[i])
    ```

边界条件：

* `dp[0][0] = 0`（第一天不持股，收益为 0）
* `dp[0][1] = -prices[0]`（第一天买入，收益为负）

---

## 二、样例推演

输入：`[8,9,2,5,4,7,1]`

| i | prices\[i] | dp\[i]\[0]（不持股） | dp\[i]\[1]（持股） | 说明     |
| - | ---------- | --------------- | -------------- | ------ |
| 0 | 8          | 0               | -8             | 初始化    |
| 1 | 9          | max(0, -8+9)=1  | max(-8, -9)=-8 | 卖出获利 1 |
| 2 | 2          | max(1, -8+2)=1  | max(-8, -2)=-2 | 更低价买入  |
| 3 | 5          | max(1, -2+5)=3  | max(-2, -5)=-2 | 卖出获利 3 |
| 4 | 4          | max(3, -2+4)=3  | max(-2, -4)=-2 | 保持     |
| 5 | 7          | max(3, -2+7)=5  | max(-2, -7)=-2 | 卖出获利 5 |
| 6 | 1          | max(5, -2+1)=5  | max(-2, -1)=-1 | 新的低点   |

最终答案：`5` ✅

---

## 三、复杂度分析

* **时间**：O(n)，遍历一次
* **空间**：O(n)，但由于只依赖前一天，可以优化到 **O(1)**

---

## 四、边界与坑点

1. **n < 2**：直接返回 0
2. **单调递减数组**：利润始终 ≤ 0 → 答案 0
3. **所有价格相等**：利润为 0
4. **空间优化**：只依赖前一状态，可用两个变量滚动存储

---

## 五、一页纸总结

* **建模**：两种状态 → 持股 / 不持股
* **转移**：

  * `dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])`
  * `dp[i][1] = max(dp[i-1][1], -prices[i])`
* **边界**：

  * `dp[0][0] = 0`
  * `dp[0][1] = -prices[0]`
* **结果**：`dp[n-1][0]`
* **复杂度**：O(n) 时间，O(1) 空间（可优化）

> 牢记：**状态机 DP 框架：持股 / 不持股**，本题一次买卖就能用这个模型优雅解决。


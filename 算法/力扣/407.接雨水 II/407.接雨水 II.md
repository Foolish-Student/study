# 407.接雨水 II

给定一个 m × n 的矩阵，其中每个单元格的值为非负整数，表示二维高度图的高度。请计算在下雨后，这个二维地形能够接住的最大雨水体积。矩阵的边界不能存水，水只能被低洼地块积累，体积计算以整数单位计。

---

## 思路总结

这道题是二维版本的“接雨水”问题，本质上是 **模拟水流在低洼地形中的积累过程**。你的代码中实现了两种主要方法：**最小堆优先队列方法（PQ BFS）** 和 **BFS水位扩展方法**。下面分别总结：

### 1. 最小堆优先队列方法（PQ BFS）

1. **边界初始化**

   * 将矩阵的边界单元加入最小堆，记录每个单元的坐标和高度。
   * 边界单元标记为已访问，因为边界无法积水。

2. **最小堆处理低洼单元**

   * 每次从堆中弹出当前最低高度单元。
   * 检查其四个方向的邻居，如果邻居未访问，判断能否积水：

     * 若邻居高度低于当前单元高度，则可积水。
     * 积水量 = 当前单元高度 - 邻居高度。
   * 更新邻居的水位为 max(邻居原高度, 当前单元高度)，保证水位不会低于已有水位。

3. **BFS扩展**

   * 将访问过的邻居标记为已访问，并加入最小堆，继续向内扩展。
   * 通过最小堆保证每次处理当前最低水位单元，模拟水从边界向内部流动的过程。

4. **累加总雨水量**

   * 每次计算的水量累加到结果中，最终得到整个地形的最大接水体积。

---

### 2. BFS水位扩展方法

1. **初始化水位**

   * 先找到矩阵中最大的高度值，假设初始水位为 maxHeight。
   * 初始化一个水位矩阵，每个单元记录当前位置的水位高度。

2. **边界处理**

   * 将边界单元的水位设置为地形高度（边界不能积水）。
   * 将边界单元加入队列进行 BFS 扩展。

3. **BFS遍历更新水位**

   * 逐个处理队列中的单元，检查四个方向的邻居。
   * 若邻居水位大于当前单元水位，并且邻居水位大于邻居地形高度，则更新邻居水位为 max(当前单元水位, 邻居地形高度)。
   * 将更新过的邻居加入队列继续扩展，直到所有可更新的水位处理完成。

4. **计算雨水体积**

   * 遍历整个矩阵，累加每个单元水位与地形高度的差值，即为每个单元可积水量。
   * 最终累加得到最大接雨水体积。

---

## 思路对比

| 方法               | 核心思想                     | 数据结构        | 优势                     |
| ---------------- | ------------------------ | ----------- | ---------------------- |
| 最小堆优先队列 (PQ BFS) | 模拟水从边界向内部流动，每次处理最低高度单元   | 最小堆 + 已访问标记 | 精确控制水流方向，处理低洼优先，逻辑直观   |
| BFS水位扩展          | 初始化水位为最大高度，通过BFS不断调整邻居水位 | 队列 + 水位矩阵   | 简单直观，通过水位矩阵记录水的流动，易于实现 |

---

## 总结

* 这道题的核心是 **从边界向内部扩展，计算每个单元的水位**。
* 两种方法都利用了 BFS 遍历：

  * **PQ BFS** 使用最小堆保证每次处理最低点，模拟水优先填低洼。
  * **BFS水位扩展** 通过水位矩阵和队列逐步更新邻居水位。
* 最终，通过累加每个单元的水位与地形高度差，得到整个矩阵的最大接水体积。


# 提交任务
## 函数解释
```cpp
template <typename F, typename R = std::invoke_result_t<std::decay_t<F>>>
[[nodiscard]] std::future<R> submit_task(F&& task, const priority_t priority = 0)
```
* `std::decay_t<F>`: 去除引用和cv限定符，获得纯类型
* `typename R = std::invoke_result_t<std::decay_t<F>>`: 获取函数F的返回值类型
* `std::future<R>`: 异步获取任务执行结果的句柄

## 构造返回值
```cpp
const std::shared_ptr<std::promise<R>> promise = std::make_shared<std::promise<R>>();
std::future<R> future = promise-> get_future();
```

创建 promise-future 对：
- `promise` 用于在worker线程中设置结果
- `future` 返回给调用者获取结果

## 提交任务
```cpp
detach_task(
    [task = std::forward<F>(task), promise = std::move(promise)]() mutable
    {
        try
        {
            if constexpr (std::is_void_v<R>)
            {
                task();
                promise-> set_value();
            }
            else
            {
                promise-> set_value(task());
            }
        }
        catch (...)
        {
            try
            {
                promise-> set_exception(std::current_exception());
            }
            catch (...)
            {
            }
        }
    },priority);
```

包装原始任务：
1. **void返回值**：执行任务后调用 `promise->set_value()`
2. **有返回值**：执行任务后调用 `promise->set_value(task())`
3. **异常处理**：捕获异常并通过 `promise->set_exception()` 传递